{% extends 'procesos/base.html' %}
{% load staticfiles %}

{% block elements_navbar %}
    <a href="/procesos/{{ proceso.proyecto.slug }}/" class="btn btn-success btn-crear-proyecto">Regresar</a>
{% endblock elements_navbar %}

{% block page_wrapper %}

	<div id="page-inner">

		<!-- Modal -->
		<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		        <h4 class="modal-title" id="myModalLabel">Eliminar Proyecto</h4>
		      </div>
		      <div class="modal-body">
		        <p>Desea eliminar todo el contenido de su proyecto <span id="js-spanNameProject"></span>?</p>
		      </div>
		      <div class="modal-footer">
		      	<form method="post" id="js-frmEliminar">
		      		{% csrf_token %}
		      		<input type="hidden" id="modal_id_proyecto" name="proyecto_id" />
			        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			        <button type="submit" class="btn btn-danger">Eliminar</button>
			    </form>
		      </div>
		    </div>
		  </div>
		</div>
		<!-- ./Modal -->

		<div class="row">
	        <div class="col-md-12">
	            <div class="alert alert-success">Agregado</div>
	        </div>
	    </div> 
	    <!-- /. ROW  -->

		<div class="row">
	        <div class="col-md-12">
	            <h1 class="page-header">
	                Actividades - Proceso <span id="id_nombre_proceso-js"></span> <small>(Lista de actividades)</small>
	            </h1>
	        </div>
	    </div> 
	    <!-- /. ROW  -->

	    

		<div class="row" id="js-rowProject">

				<div class="col-md-4 col-sm-4" id="div{{ proceso.id }}">
			    	
			        <div class="panel panel-info">
			        	
				            <div class="panel-heading">
				                Agregar actividad
				            </div>
				            <div class="panel-body">
				            	<form method="post" id="formularioActividad-js">
		            				{% csrf_token %}
		            				<input type="hidden" name="proceso" value="{{ proceso.id }}">
		            				<input type="hidden" id="id_orden" name="orden" value="{{ orden_max }}">
		            				<div id="id_nombre_actividad_error" class="alert alert-danger"></div>
		            				<div class="form-group">
		            					<input type="text" id="id_nombre_actividad" name="nombre_actividad" placeholder="Nombre de la actividad">
		            				</div>
		            				<div id="id_tipo_actividad_error" class="alert alert-danger"></div>
		            				<div class="form-group">
		            					<label>Tipo de actividad: </label>
		            					<select name="tipo_actividad" id="id_tipo_actividad" class="form-control">
		            						<option value="">---------</option>
			            					<option value="E">Entrada</option>
			            					<option value="P">Proceso</option>
			            					<option value="D">Decisi贸n</option>
			            					<option value="S">Salida</option>
			            				</select>
		            				</div>
		            				
		            				<input type="button" id="agregarButton-js" class="btn btn-info" value="Agregar">
		            			</form>

				            	
				                <!-- <div><span id="id_orden-js">1</span> <span id="id_nombre_actividad-js">Registro del alumno</span></div>
				                <div><span id="id_orden-js">2</span> <span id="id_nombre_actividad-js">Autorizaci贸n de SE</span></div> -->
				            </div>
			        
			    	</div>
			    </div>

			    <div class="col-md-8 col-sm-8" id="div{{ proceso.id }}">
			    	
			        <div class="panel panel-info">
			        	
				            <div class="panel-heading">
				                <h3>{{ proceso.nombre_proceso }}</h3>
				            </div>

				            <div class="panel-body">

				            	<div class="table-responsive">
                                    <table class="table table-striped table-bordered table-hover">
                                        <thead>
                                            <tr>
                                                <th>No.</th>
                                                <th>Actividad</th>
                                                <th>Tipo</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        	{% for actividad in actividades %}
                                            <tr>
                                                <td>{{ actividad.orden }}</td>
                                                <td>{{ actividad.nombre_actividad }}</td>
                                                <td>{{ actividad.tipo_actividad }}</td>    
                                            </tr>
                                            {% endfor %}

                                        </tbody>
                                    </table>
                                </div>
				                <!-- <div><span id="id_orden-js">1</span> <span id="id_nombre_actividad-js">Registro del alumno</span></div>
				                <div><span id="id_orden-js">2</span> <span id="id_nombre_actividad-js">Autorizaci贸n de SE</span></div> -->
				            </div>
				            <div class="panel-footer">
				                Descripci贸n: {{ proceso.descripcion_proceso }}
				            </div>
			            
			            
			        
			    	</div>
			    </div>
		    
		</div>
		<!-- /. ROW  -->
	</div>
	<!-- /. PAGE INNER  -->

{% endblock page_wrapper %}

{% block js_scripts %}
	<script src="{% static "documentation_app/js/jquery.form.min.js" %}"></script>
{% endblock js_scripts %}

{% block custom_scripts %}
	<script src="{% static "proyectos/js/proyecto-list-scripts.js" %}"></script>
	<script>
	/*
	function ocultarAlert()
	{
		$('.alert').slideToggle();
	}

	$('.alert').hide();
	$.getJSON('/api/procesos/1', function (data) {
		console.log(data);
		$('#id_nombre_proceso-js').text(data.nombre_proceso);
		$('.alert').text('Actividad agregada').slideToggle();
		setTimeout(ocultarAlert, 3000);
	});
	*/
	function ocultarAlert()
	{
		$('.alert-success').slideToggle();
	}

	$('#id_nombre_actividad').focus();
	$('.alert-success').hide();
	$('.alert-danger').hide();

	$('#agregarButton-js').click(function () {
		$.ajax({
			url: '/procesos/',
			type: 'POST',
			dataType: 'json',
			data: $('#formularioActividad-js').serialize(),
			error: function (xhr, status, error) {
				console.log(xhr.responseJSON);
				console.log(error);

				alert("Antes del if de nombre_actividad");
				if (typeof(xhr.responseJSON.nombre_actividad[0]) != "undefined")
				{
					$('#id_nombre_actividad_error').text(xhr.responseJSON.nombre_actividad[0]).slideDown();
					$('#id_nombre_actividad').focus();
				}
				else
				{
					alert("No existe error en nombre_actividad");
					$('#id_nombre_actividad_error').slideUp();
				}
				alert("Despues del if de nombre_actividad");

				if (typeof(xhr.responseJSON.tipo_actividad[0]) != "undefined")
				{
					$('#id_tipo_actividad_error').text(xhr.responseJSON.tipo_actividad[0]).slideDown();
					$('#id_tipo_actividad').focus();
				}
				else
				{
					$('#id_tipo_actividad_error').slideUp();
				}
				
				
			}

		})
		.done(function (data) {
			var tipo_actividad = $('#id_tipo_actividad option:selected').text();
			var orden_max = parseInt($('#id_orden').val()) + 1;
			$('#id_orden').val(orden_max);

			$('tbody').append('<tr><td>' + data.orden + '</td><td>' + data.nombre_actividad + '</td><td>' + tipo_actividad + '</td></tr>')

			$('.alert-success').text('Actividad agregada').slideToggle();
			$('.alert-danger').slideUp();
			$('#id_nombre_actividad').val('').focus();
			$('#id_tipo_actividad option:eq(0)').prop('selected', true);
			setTimeout(ocultarAlert, 3000);
		});
	});
	
	</script>
{% endblock custom_scripts %}